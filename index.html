<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Multiplayer Mouse Tracker</title>
<style>
  canvas { border:1px solid black; display:block; margin:0 auto; background:#f0f0f0; }
</style>
</head>
<body>
<canvas id="canvas" width="800" height="400"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const playerId = crypto.randomUUID();

let gameState = { players: {} };

// Connect to Worker
const ws = new WebSocket('wss://https://ancient-poetry-3a52.barmstrong910.workers.dev/ws'); // replace
ws.onopen = () => ws.send(JSON.stringify({ type:'join', id:playerId }));

ws.onmessage = e => {
  let msg;
  if(typeof e.data === 'string') msg = JSON.parse(e.data);
  else msg = JSON.parse(new TextDecoder().decode(e.data));

  if(msg.type === 'state') gameState = msg.data;
};

// Track mouse locally
const mouse = { x: 0, y: 0 };
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = e.clientY - rect.top;
});

// Send mouse position to server
function sendMouse(){
  ws.send(JSON.stringify({ type:'input', id:playerId, input:{ mouseX: mouse.x, mouseY: mouse.y } }));
}

// Draw all players' cursors
function draw(){
  ctx.fillStyle = '#f0f0f0';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(const id in gameState.players){
    const p = gameState.players[id];
    ctx.fillStyle = (id===playerId) ? 'red' : 'blue';
    ctx.beginPath();
    ctx.arc(p.input?.mouseX || 0, p.input?.mouseY || 0, 8, 0, Math.PI*2);
    ctx.fill();
  }
}

// Loop
function loop(){
  sendMouse();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
