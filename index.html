<!DOCTYPE html>
<html>
<head>
<title>Multiplayer Mouse Tracker</title>
<style>
  body { margin:0; overflow:hidden; background:black; }
  canvas { display:block; }
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let myId = null;
let players = {};

const ws = new WebSocket("wss://" + location.host + "/ws");

// Handle messages
ws.onmessage = e => {
  let msg;

  if (typeof e.data === "string") {
    msg = JSON.parse(e.data);
  } else {
    msg = JSON.parse(new TextDecoder().decode(e.data));
  }

  if (msg.type === "init") {
    myId = msg.yourId;
  }

  if (msg.type === "state") {
    players = msg.data;
  }
};

// Send mouse position
document.addEventListener("mousemove", e => {
  ws.send(JSON.stringify({
    type: "input",
    input: { mouseX: e.clientX, mouseY: e.clientY }
  }));
});

// Draw loop
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  for (const id in players) {
    const p = players[id];

    // Self = red, others = blue
    ctx.fillStyle = (id === myId) ? "red" : "cyan";
    ctx.beginPath();
    ctx.arc(p.input.mouseX, p.input.mouseY, 10, 0, Math.PI * 2);
    ctx.fill();

    // Label
    ctx.fillStyle = "white";
    ctx.fillText(id.substring(0, 6), p.input.mouseX + 12, p.input.mouseY + 4);
  }

  requestAnimationFrame(draw);
}

draw();
</script>

</body>
</html>

loop();
</script>
</body>
</html>
